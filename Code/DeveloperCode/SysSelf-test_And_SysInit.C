/* *******************************************************************************************
// Author: biu~
// System self-test and initialization;系统自检与初始化；
/* ******************************************************************************************* */

#include "SysSelf-test_And_SysInit.H"

/* *******************************************************************************************
// 系统自检与初始化整合函数：
/* ******************************************************************************************* */
extern void initIO();
extern void sysSelftest();
extern void sysInit();
extern void initOver();
void SysSelftest_And_SysInit()
{
    // IO电平初始化：
    initIO();
    // 系统自检：
    sysSelftest();
    // 系统初始化：
    sysInit();
}
/* *******************************************************************************************
// 系统自检：
/* ******************************************************************************************* */
static void sysSelftest()
{
    // 系统状态提示灯常亮0.8S：
    SysLED_On();
    DelayMS(800);
    SysLED_Off();
}
/* *******************************************************************************************
// 系统初始化
/* ******************************************************************************************* */
static void sysInit()
{
    // 定时器PWM输出初始化：
    TimerPWM_Init();
    // 时基定时器初始化并开启中断总开关：
    InitInterrupt();
    // 初始化完毕提示：
    initOver();
}

/* *******************************************************************************************
// IO电平初始化
/* ******************************************************************************************* */
static void initIO()
{
    P0 = 0xFF;
    P1 = 0xFF;	
    P2 = 0xFF;	
    P3 = 0xFF;	
    P4 = 0xFF;	
    P5 = 0xFF;	
    P6 = 0xFF;	
    P7 = 0xFF;	
    P0M0 = 0x00;	
    P0M1 = 0x00;	
    P1M0 = 0x00;	
    P1M1 = 0x00;	
    P2M0 = 0x00;	
    P2M1 = 0x00;	
    P3M0 = 0x00;	
    P3M1 = 0x00;	
    P4M0 = 0x00;	
    P4M1 = 0x00;	
    P5M0 = 0x00;	
    P5M1 = 0x00;	
    P6M0 = 0x00;	
    P6M1 = 0x00;	
    P7M0 = 0x00;	
    P7M1 = 0x00;	
}

/* *******************************************************************************************
// 初始化完成提示
/* ******************************************************************************************* */
static void initOver()
{
    SysLED_Flash(50, 3);
}
